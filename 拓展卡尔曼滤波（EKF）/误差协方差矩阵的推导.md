前置[卡尔曼增益的推导](卡尔曼增益的推导)
## 复习一下吧！
### ***先验估计公式***
$$\hat{x_k^-}=A\hat{x_{k-1}}+B\mu_{k-1}$$
### ***后验估计公式***
$$\hat{x_k}=\hat{x_k^-}+k_K(z_k-H\hat{x_k^-})$$
### ***卡尔曼增益公式***
$$k_K=\frac{(P_k^-H^T)}{(HP_k^-H^T+R)} $$
### 精确公式
$$x_k=Ax_{k-1}+B\mu_{k-1}+\omega_{k-1}$$
我们前两个公式中，就差$k_K$没求出来了，而第三个式子中就差$P_k^-$没求出来。我们这节的目标就是求$P_k^-$.
## $P_k^-$,启动！
$$P_k^-=E(e_k^-e_k^{-T})$$

$$e_k^-=(x_k-\hat{x_t^-})=A(x_{k-1}-\hat{x_{k-1}})+\omega_{k-1}=Ae_{k-1}+\omega_{k-1}$$
$$P_k^-=E[(Ae_{k-1}+\omega_{k-1})(Ae_{k-1}+\omega_{k-1})^T]$$
$$P_k^-=E[Ae_{k-1}e_{k-1}^TA^T]+E[Ae_{k-1}\omega_{k-1}^T]+E[\omega_{k-1}e_{k-1}^TA^T]+E[\omega_{k-1}\omega_{k-1}^T]$$
注意到，$\omega_{k-1}$ 虽然套皮$k-1$，但是实际上是作用在$x_k$上的，所以与$e_{k-1}$相互独立。故第二项第三项都为0.
$$P_k^-=AP_{k-1}A^T+Q$$
有个误区就是，有人认为$\omega$是噪声，所以Q也是个随机分布，但是是错的，因为Q代表是这个随机噪声的协方差分布，所以是一个常量！
## 预测与校正
到此为止，卡尔曼滤波器的大部分理论内容已经完成，接下来我们通过两步：预测和校正来获得较为精确的后验估计.
### 预测
- 算先验
$$\hat{x_k^-}=A\hat{x_{k-1}}+B\mu_{k-1}$$
- 算先验误差协方差
$$P_k^-=AP_{k-1}A^T+Q$$
### 校正
- 算卡尔曼增益
$$k_K=\frac{P_k^-H^T}{HP_k^-H^T+R}$$
- 算后验估计（就是你要的结果啦）
$$\hat{x_k}=\hat{x_k^-}+k_K(z_k-H\hat{x_k^-})$$
但是呢（敲黑板），我们注意到算误差协方差的时候用到了上一次的$P_{k-1}$,于是我们也必须算一下$P_k$.
$$P_k=P_k^--k_KHP_k^--P_k^-H^Tk_K^T+k_K(HP_k^-H^T+R)k_K^T$$
把第四项前面的那个$k_K$用算出来的结果代入（后面先别代），就会发现第四项和第三项相等，您猜怎么着，抵消了。
于是
- 更新误差协方差
$$P_k=(I-k_KH)P_k^-$$
原来吓人的长公式被化成了这样子，果然小小的才可爱（喜
